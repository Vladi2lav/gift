<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ключи</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--muted:#9ca3af;--accent:#7dd3fc}
    body{font-family:Inter,Segoe UI,Arial,sans-serif;background:linear-gradient(180deg,#081124 0%,#071021 100%);color:#e6eef8;margin:0;padding:36px;min-height:100vh}
    .wrap{max-width:880px;margin:0 auto}
    h1{font-size:28px;margin:0 0 18px}
    p.lead{color:var(--muted);margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:24px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));border:1px solid rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .title{font-weight:600;margin:0 0 6px}
    .when{color:var(--muted);font-size:13px;margin-bottom:12px}
    .count{font-family:monospace;background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;display:inline-block}
    .actions{margin-top:14px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;text-decoration:none;color:#04243b;background:var(--accent);font-weight:600}
    .btn.disabled{opacity:.45;pointer-events:none;background:transparent;border:1px dashed rgba(255,255,255,0.04);color:var(--muted)}
    .note{margin-top:12px;font-size:13px;color:var(--muted)}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Таймированные загрузки</h1>
  <p class="lead">Здесь три ссылки на скачивание. Первый файл откроется 04.10.2025; второй — через 2 дня после первого, третий — ещё через 1 день.</p>

    <div class="grid" id="downloadGrid">
      <!-- cards injected by JS -->
    </div>

  <p class="note">Файлы находятся в корне сайта: <code>a.rar</code>, <code>b.rar</code>, <code>c.rar</code>. На дату открытия кнопка станет активной и позволит скачать соответствующий архив.</p>
  </div>

  <script>
    // Contract
  // Inputs: three unlock dates (first: 2025-10-04, second +1 day, third +2 days)
    // Outputs: three cards with countdowns and a download button that becomes active when now >= unlock

    const baseDate = new Date('2025-10-04T00:00:00'); // local timezone midnight
  const offsets = [0, 1.5, 2.5]; // days after baseDate for each file
  const fileNames = ['./a.rar','./b.rar','./c.rar'];

    const grid = document.getElementById('downloadGrid');

    function pad(n){return String(n).padStart(2,'0')}

    function formatDate(d){
      return d.toLocaleString('ru-RU', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
    }

    const items = offsets.map((days,i)=>{
      const unlock = new Date(baseDate.getTime());
      unlock.setDate(unlock.getDate() + days);
      return {id:i+1, days, unlock};
    });

    function createCard(item){
      const div = document.createElement('div');
      div.className = 'card';

      const title = document.createElement('div'); title.className='title'; title.textContent = `Файл ${item.id}`;
      const when = document.createElement('div'); when.className='when'; when.textContent = `Открытие: ${formatDate(item.unlock)}`;
      const count = document.createElement('div'); count.className='count'; count.textContent='...';
      const actions = document.createElement('div'); actions.className='actions';
  const a = document.createElement('a');
  a.className='btn disabled';
  // assign file per card (if exists on server/filesystem)
  const file = fileNames[item.id - 1] || './a.rar';
  a.href = file;
  // set suggested download filename to the archive name
  const suggest = file.split('/').pop();
  a.setAttribute('download', suggest);
  a.textContent = `Скачать ${suggest}`;

      actions.appendChild(a);
      div.appendChild(title);
      div.appendChild(when);
      div.appendChild(count);
      div.appendChild(actions);

      return {el:div, countEl:count, linkEl:a, item};
    }

    const cards = items.map(it=>{
      const c = createCard(it);
      grid.appendChild(c.el);
      return c;
    });

    function update(){
      const now = new Date();
      cards.forEach(c=>{
        const diff = c.item.unlock - now;
        if(diff <= 0){
          c.countEl.textContent = 'Доступно';
          c.linkEl.classList.remove('disabled');
          c.linkEl.title = 'Нажмите, чтобы скачать';
        } else {
          const s = Math.floor(diff/1000);
          const days = Math.floor(s/86400); const hours = Math.floor((s%86400)/3600); const mins = Math.floor((s%3600)/60); const secs = s%60;
          c.countEl.textContent = `${pad(days)}д ${pad(hours)}ч ${pad(mins)}м ${pad(secs)}с`;
          c.linkEl.classList.add('disabled');
          c.linkEl.removeAttribute('title');
        }
      });
    }

    // initial update and interval
    update();
    setInterval(update,1000);

    // accessibility: prevent navigation for disabled links
    document.addEventListener('click', e=>{
      const t = e.target.closest('.btn');
      if(t && t.classList.contains('disabled')){ e.preventDefault(); }
    });
  </script>
</body>
</html>
